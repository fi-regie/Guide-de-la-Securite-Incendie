<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guide de la S√©curit√© Incendie - CTS & ERP Type L</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Styles harmonis√©s avec le Portail */
        :root {
            --color-primary: #1F2937;      /* Gris anthracite */
            --color-secondary: #6B7280;     /* Gris secondaire */
            --color-accent: #ea580c;        /* Orange s√©curit√© (harmonis√©) */
            --color-success: #059669;       /* Vert conformit√© */
            --color-warning: #D97706;       /* Orange attention */
            --color-structure: #334155;     /* Ardoise structure */
            --color-background: #FDFBF7;    /* Fond papier chaud */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
            color: var(--color-primary);
            scroll-behavior: auto !important;
        }
        
        /* Styles pour tous les onglets */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .nav-tab.active {
            border-bottom-color: #ea580c;
            color: #ea580c;
            font-weight: 600;
        }
        
        /* Navigation Active State - Harmonis√© */
        .nav-active {
            border-bottom: 2px solid var(--color-accent);
            color: var(--color-accent);
            font-weight: 600;
        }
        
        /* Chart Containers */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        /* Smooth Transitions */
        .tab-transition {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        
        /* Card Hover Effects */
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Priority Indicators */
        .priority-1 { border-left-color: var(--color-accent); }
        .priority-2 { border-left-color: var(--color-structure); }
        .priority-3 { border-left-color: var(--color-success); }
        
        /* Custom colors for Tailwind */
        .text-accent { color: var(--color-accent); }
        .bg-accent { background-color: var(--color-accent); }
        .text-success { color: var(--color-success); }
        .bg-success { background-color: var(--color-success); }
        .text-warning { color: var(--color-warning); }
        .bg-warning { background-color: var(--color-warning); }
        .border-accent { border-color: var(--color-accent); }
        .border-success { border-color: var(--color-success); }
        .border-warning { border-color: var(--color-warning); }
        .accent-success { accent-color: var(--color-success); }
        .accent-warning { accent-color: var(--color-warning); }
        .accent-structure { accent-color: var(--color-structure); }
        
        /* Pulse animation for beta badge */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Assurer que la page commence toujours en haut */
        html {
            scroll-behavior: auto !important;
        }
        
        /* Additional styles from maquette */
        .tab-active {
            border-bottom: 2px solid #ea580c;
            color: #ea580c;
            font-weight: 600;
        }
        
        .section-hidden { display: none; }
        .section-visible { 
            display: block; 
            animation: fadeIn 0.3s ease-in-out; 
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans">

    <!-- ===== EN-T√äTE HARMONIS√â ===== -->
    <nav class="bg-white border-b border-stone-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl mr-2"></span>
                    <h1 class="text-xl font-bold tracking-tight text-slate-700">Guide de la S√©curit√© Incendie
                        <span class="text-orange-600 text-sm font-normal uppercase ml-2 tracking-widest">CTS & ERP</span>
                    </h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='https://fi-regie.github.io/Portail-Securite-CTS-ERP-Type-L/#accueil';"
                        class="text-sm text-stone-500 hover:text-orange-600 transition flex items-center hidden sm:inline-flex">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Retour √† l'accueil
                    </button>
                    <div class="h-3 w-3 rounded-full bg-emerald-500 animate-pulse" title="Application active"></div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ===== NAVIGATION HARMONIS√âE ===== -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="max-w-8xl mx-auto">
            <nav class="flex overflow-x-auto no-scrollbar">
                <button onclick="app.navigate('dashboard')"
                    class="nav-tab active px-6 py-4 border-b-2 border-orange-600 text-orange-600 font-semibold whitespace-nowrap flex items-center">
                    <i class="fas fa-chart-line mr-2"></i>
                    Tableau de Bord
                </button>
                <button onclick="app.navigate('classification')"
                    class="nav-tab px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-orange-600 whitespace-nowrap flex items-center">
                    <i class="fas fa-layer-group mr-2"></i>
                    Classification ERP
                </button>
                <button onclick="app.navigate('materials')"
                    class="nav-tab px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-orange-600 whitespace-nowrap flex items-center">
                    <i class="fas fa-fire-extinguisher mr-2"></i>
                    Mat√©riaux & Incendie
                </button>
                <button onclick="app.navigate('evacuation')"
                    class="nav-tab px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-orange-600 whitespace-nowrap flex items-center">
                    <i class="fas fa-door-open mr-2"></i>
                    √âvacuation
                </button>
                <button onclick="app.navigate('cts')"
                    class="nav-tab px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-orange-600 whitespace-nowrap flex items-center">
                    <i class="fas fa-tent mr-2"></i>
                    Chapiteaux & CTS
                </button>
                <button onclick="app.navigate('library')"
                    class="nav-tab px-6 py-4 border-b-2 border-transparent text-gray-600 hover:text-orange-600 whitespace-nowrap flex items-center">
                    <i class="fas fa-book mr-2"></i>
                    Biblioth√®que
                </button>
            </nav>
        </div>
    </div>

    <!-- Main Content -->
    <main class="flex-grow py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- ===== DASHBOARD VIEW ===== -->
            <div id="view-dashboard" class="space-y-8 tab-transition active">
                <!-- Welcome & Context - Style harmonis√© -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6 md:p-8">
                    <h1 class="text-3xl font-bold text-slate-800 mb-4">Portail de la S√©curit√© Incendie</h1>
                    <p class="text-stone-600 leading-relaxed mb-6">
                        Ce portail rassemble l'ensemble des outils r√©glementaires pour la s√©curit√© du spectacle vivant. 
                        Con√ßu pour les directeurs techniques, r√©gisseurs et exploitants, il synth√©tise les obligations 
                        des ERP Type L (salles) et CTS (chapiteaux), avec les derni√®res √©volutions l√©gislatives.
                    </p>
                    
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-6">
                        <h3 class="font-bold text-blue-800 mb-2">üìã Mission du R√©gisseur Responsable Technique</h3>
                        <p class="text-sm text-blue-700">
                            En tant que responsable technique, vous devez garantir la conformit√© r√©glementaire de l'√©tablissement 
                            avant toute ouverture au public. Ce portail vous fournit les outils pour :
                        </p>
                        <ul class="text-sm text-blue-700 mt-2 list-disc list-inside">
                            <li>D√©terminer la cat√©gorie r√©glementaire de votre √©v√©nement</li>
                            <li>V√©rifier la conformit√© des mat√©riaux sc√©niques (classement M)</li>
                            <li>Dimensionner correctement les issues de secours</li>
                            <li>Contr√¥ler les conditions d'exploitation des chapiteaux</li>
                            <li>Pr√©parer le dossier de s√©curit√© pour la commission</li>
                        </ul>
                    </div>
                    
                    <!-- Principes Fondamentaux -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="priority-1 bg-white p-6 rounded-xl border-l-4 border-accent shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-users text-red-600"></i>
                                </div>
                                <h3 class="font-bold text-slate-700">S√©curit√© des Personnes</h3>
                            </div>
                            <p class="text-sm text-gray-600">L'√©vacuation rapide et s√ªre du public est l'objectif premier. Toutes les dispositions techniques doivent y concourir.</p>
                        </div>
                        
                        <div class="priority-2 bg-white p-6 rounded-xl border-l-4 border-structure shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-fire text-orange-600"></i>
                                </div>
                                <h3 class="font-bold text-slate-700">Lutte contre l'Incendie</h3>
                            </div>
                            <p class="text-sm text-gray-600">Limitation des risques d'√©closion, de d√©veloppement et de propagation du feu par des mesures constructives et organisationnelles.</p>
                        </div>
                        
                        <div class="priority-3 bg-white p-6 rounded-xl border-l-4 border-success shadow-sm">
                            <div class="flex items-center mb-4">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3">
                                    <i class="fas fa-shield-alt text-green-600"></i>
                                </div>
                                <h3 class="font-bold text-slate-700">Conformit√© R√©glementaire</h3>
                            </div>
                            <p class="text-sm text-gray-600">Respect strict des arr√™t√©s 1980 (ERP) et 1985 (CTS). La commission de s√©curit√© v√©rifie l'application int√©grale des textes.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Stats - Style harmonis√© -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Textes Fondateurs</p>
                                <p class="text-2xl font-bold text-gray-900">2</p>
                                <p class="text-xs text-success">Arr√™t√©s 1980 & 1985</p>
                            </div>
                            <div class="h-12 w-12 bg-red-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-scroll text-red-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Cat√©gories ERP</p>
                                <p class="text-2xl font-bold text-gray-900">5</p>
                                <p class="text-xs text-warning">1√®re √† 5√®me cat.</p>
                            </div>
                            <div class="h-12 w-12 bg-orange-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-building text-orange-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Classements Mat√©riaux</p>
                                <p class="text-2xl font-bold text-gray-900">5</p>
                                <p class="text-xs text-gray-600">M0 √† M4</p>
                            </div>
                            <div class="h-12 w-12 bg-blue-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-fire text-blue-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 card-hover">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm font-medium text-gray-500">R√®glementation 2025</p>
                                <p class="text-2xl font-bold text-gray-900">2</p>
                                <p class="text-xs text-accent">Arr√™t√©s actualis√©s</p>
                            </div>
                            <div class="h-12 w-12 bg-green-50 rounded-full flex items-center justify-center">
                                <i class="fas fa-gavel text-green-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Access Grid - Style harmonis√© -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div onclick="app.navigate('classification')" class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-accent cursor-pointer card-hover">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-calculator text-blue-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900">Calculateur de Cat√©gorie</h3>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">D√©terminez la cat√©gorie de votre ERP en fonction de la jauge. Int√©gration des articles GN.</p>
                        <span class="text-xs text-accent font-medium">Acc√©der <i class="fas fa-arrow-right ml-1"></i></span>
                    </div>
                    
                    <div onclick="app.navigate('cts')" class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-warning cursor-pointer card-hover">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-wind text-orange-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900">Simulateur Vent CTS</h3>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">V√©rifiez les conditions m√©t√©o pour chapiteaux selon l'Arr√™t√© 1985.</p>
                        <span class="text-xs text-warning font-medium">Acc√©der <i class="fas fa-arrow-right ml-1"></i></span>
                    </div>
                    
                    <div onclick="app.navigate('evacuation')" class="bg-white p-6 rounded-xl shadow-sm border border-gray-200 hover:border-success cursor-pointer card-hover">
                        <div class="flex items-center mb-4">
                            <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center mr-4">
                                <i class="fas fa-door-open text-emerald-600 text-xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-900">Calcul des D√©gagements</h3>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Dimensionnez les sorties selon l'affluence. Application des articles CO.</p>
                        <span class="text-xs text-success font-medium">Acc√©der <i class="fas fa-arrow-right ml-1"></i></span>
                    </div>
                </div>
                
                <!-- Overview Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h3 class="text-lg font-semibold text-slate-700 mb-4">R√©partition des Responsabilit√©s du R√©gisseur</h3>
                    <div class="chart-container">
                        <canvas id="overviewChart"></canvas>
                    </div>
                    <div class="mt-4 text-sm text-gray-600">
                        <p><strong>Analyse :</strong> La s√©curit√© incendie repr√©sente 35% des pr√©occupations r√©glementaires du r√©gisseur, suivie par la solidit√© des structures (25%).</p>
                    </div>
                </div>
            </div>
            
            <!-- ===== CLASSIFICATION VIEW ===== -->
            <div id="view-classification" class="hidden space-y-8 tab-transition">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-2">Classification des ERP - Articles GN</h2>
                    <p class="text-stone-600 mb-6">
                        La cat√©gorie de votre √©tablissement d√©termine la s√©v√©rit√© des r√®gles (SSIAP, visites de commission, etc.). 
                        Elle est calcul√©e selon l'effectif total (public + personnel non indispensable). Le classement est d√©fini par l'article GN 2 de l'Arr√™t√© du 25 juin 1980.
                    </p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Calculator -->
                        <div class="lg:col-span-1 bg-gray-50 p-6 rounded-xl border-t-4 border-structure">
                            <h4 class="text-lg font-bold text-gray-800 mb-4">Calculateur de Cat√©gorie</h4>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Effectif Total (Personnes)</label>
                            <div class="flex items-center space-x-2 mb-6">
                                <input type="number" id="capacityInput" value="450" min="0" max="10000" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-accent focus:ring-accent sm:text-lg p-3 border bg-white">
                                <button onclick="calculateCategory()" class="bg-structure text-white px-4 py-3 rounded-md hover:bg-gray-800 transition">
                                    <i class="fas fa-calculator mr-2"></i>Calculer
                                </button>
                            </div>
                            
                            <div id="categoryResult" class="bg-white rounded-lg p-4 border border-gray-200">
                                <h4 class="text-sm uppercase tracking-wide text-gray-500 font-bold mb-1">Classement</h4>
                                <p id="catText" class="text-3xl font-bold text-accent mb-2">3√®me Cat√©gorie</p>
                                <p id="catDesc" class="text-sm text-gray-600">Entre 301 et 700 personnes.</p>
                                <div class="mt-4 pt-4 border-t border-gray-200">
                                    <h5 class="text-xs font-bold text-gray-700 mb-1">Implications Cl√©s :</h5>
                                    <p id="catImplication" class="text-sm text-gray-600 italic">Visite p√©riodique tous les 3 ans. Pr√©sence SSIAP requise selon risque. Registre de s√©curit√© obligatoire.</p>
                                </div>
                            </div>
                            
                            <div class="mt-6 p-4 bg-blue-50 rounded-lg border border-blue-200">
                                <h5 class="font-bold text-blue-800 text-sm mb-2">üìù Pour le R√©gisseur :</h5>
                                <p class="text-xs text-blue-700">
                                    La cat√©gorie d√©termine la fr√©quence des visites de commission et les obligations de moyens (SSIAP, √©quipements). 
                                    Conservez le justificatif de calcul dans votre dossier de s√©curit√©.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Chart -->
                        <div class="lg:col-span-2">
                            <h4 class="text-sm font-semibold text-gray-500 mb-4 uppercase">Seuils R√©glementaires (ERP Type L)</h4>
                            <div class="chart-container">
                                <canvas id="classificationChart"></canvas>
                            </div>
                            <p class="text-xs text-gray-400 mt-2 text-center">Les seuils de 300, 700 et 1500 personnes marquent les changements de cat√©gorie (Article GN 2).</p>
                            
                            <div class="mt-6 grid grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h5 class="font-bold text-gray-700 text-sm mb-2">Premier Groupe</h5>
                                    <p class="text-xs text-gray-600">Cat√©gories 1 √† 4. Soumis √† l'ensemble des dispositions du r√®glement.</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h5 class="font-bold text-gray-700 text-sm mb-2">Second Groupe</h5>
                                    <p class="text-xs text-gray-600">5√®me cat√©gorie. R√®gles all√©g√©es mais obligations de s√©curit√© maintenues.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reference Table -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-slate-700 mb-4">Tableau de R√©f√©rence des Cat√©gories</h3>
                        <div class="overflow-hidden border border-gray-200 rounded-lg">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Groupe</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cat√©gorie</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Seuil</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Implications pour le R√©gisseur</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td class="px-6 py-4 font-bold" rowspan="4">1er Groupe</td>
                                        <td class="px-6 py-4"><span class="font-bold text-red-600">1√®re Cat√©gorie</span></td>
                                        <td class="px-6 py-4">> 1500 personnes</td>
                                        <td class="px-6 py-4 text-sm">SSIAP permanent 24h/24. Visites commission tous les 3 ans. Dossier de s√©curit√© tr√®s complet.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4"><span class="font-bold text-orange-600">2√®me Cat√©gorie</span></td>
                                        <td class="px-6 py-4">701 √† 1500</td>
                                        <td class="px-6 py-4 text-sm">SSIAP adapt√© aux horaires d'ouverture. Visites tous les 3 ans. Registre de s√©curit√© v√©rifi√© annuellement.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4"><span class="font-bold text-yellow-600">3√®me Cat√©gorie</span></td>
                                        <td class="px-6 py-4">301 √† 700</td>
                                        <td class="px-6 py-4 text-sm">SSIAP selon risque. Visites tous les 3 ans. Formation du personnel obligatoire.</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4"><span class="font-bold text-green-600">4√®me Cat√©gorie</span></td>
                                        <td class="px-6 py-4">‚â§ 300 personnes</td>
                                        <td class="px-6 py-4 text-sm">R√®gles all√©g√©es mais registre obligatoire. Visites tous les 5 ans.</td>
                                    </tr>
                                    <tr class="bg-gray-50">
                                        <td class="px-6 py-4 font-bold">2√®me Groupe</td>
                                        <td class="px-6 py-4"><span class="font-bold text-blue-600">5√®me Cat√©gorie</span></td>
                                        <td class="px-6 py-4">Seuil sp√©cifique par type (ex: L: 200 pers.)</td>
                                        <td class="px-6 py-4 text-sm">R√®glementation minimale mais obligations fondamentales : issues d√©gag√©es, extincteurs, alarme.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Conseil Pratique -->
                    <div class="mt-8 bg-amber-50 p-6 rounded-xl border border-amber-200">
                        <h4 class="font-bold text-amber-800 mb-3">‚ö†Ô∏è Attention au Calcul de l'Effectif</h4>
                        <p class="text-sm text-amber-700 mb-3">
                            <strong>L'effectif total comprend :</strong> Public + Personnel non indispensable √† la s√©curit√©. 
                            Pour un spectacle, incluez les artistes en sc√®ne. Pour une salle de conf√©rence, incluez les intervenants.
                        </p>
                        <p class="text-sm text-amber-700">
                            <strong>Pi√®ge fr√©quent :</strong> Ne pas inclure le personnel technique pr√©sent pendant l'exploitation. 
                            Toute personne pr√©sente compte dans les calculs de d√©gagements.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ===== MATERIALS VIEW ===== -->
            <div id="view-materials" class="hidden space-y-8 tab-transition">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-2">Mat√©riaux & R√©action au Feu - Articles AM</h2>
                    <p class="text-stone-600 mb-6">
                        L'objectif est de limiter la masse combustible. Les mat√©riaux sont class√©s de <strong>M0 (Incombustible)</strong> √† <strong>M4 (Facilement Inflammable)</strong>.
                        L'<strong>Ignifugation</strong> permet d'am√©liorer ce classement. Le classement M1 est obligatoire pour tous les d√©cors, rideaux et v√©lums.
                    </p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
                        <!-- Chart -->
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <h4 class="font-bold text-gray-700 mb-4">R√©partition Id√©ale des Mat√©riaux en ERP Type L</h4>
                            <div class="chart-container">
                                <canvas id="materialsChart"></canvas>
                            </div>
                            <div class="mt-4 flex justify-center space-x-4 text-xs">
                                <span class="flex items-center"><span class="w-3 h-3 bg-gray-400 rounded-full mr-1"></span> M0 Structure</span>
                                <span class="flex items-center"><span class="w-3 h-3 bg-success rounded-full mr-1"></span> M1 D√©cors</span>
                                <span class="flex items-center"><span class="w-3 h-3 bg-warning rounded-full mr-1"></span> M2/M3 Mobilier</span>
                            </div>
                        </div>
                        
                        <!-- Materials Cards -->
                        <div class="space-y-4">
                            <div id="m0-card" onclick="highlightMaterial(0)" class="material-card p-4 rounded-lg border-l-4 border-gray-400 bg-white shadow-sm hover:shadow-md transition cursor-pointer">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-gray-900">Classement M0</h4>
                                    <span class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-600">Incombustible</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-2">Pierre, brique, ciment, verre, m√©tal. Utilis√© pour les structures porteuses. Pas de contribution au feu.</p>
                                <div class="mt-3 text-xs text-gray-500">
                                    <strong>Usage :</strong> Structures, murs porteurs, charpentes
                                </div>
                            </div>
                            
                            <div id="m1-card" onclick="highlightMaterial(1)" class="material-card p-4 rounded-lg border-l-4 border-success bg-green-50 shadow-sm hover:shadow-md transition cursor-pointer">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-green-900">Classement M1</h4>
                                    <span class="text-xs bg-green-100 px-2 py-1 rounded text-green-700">Non Inflammable</span>
                                </div>
                                <p class="text-sm text-green-800 mt-2">Combustible mais ne propage pas le feu. <strong>Obligatoire</strong> pour les d√©cors, rideaux, v√©lums, plafonds suspendus.</p>
                                <div class="mt-3 text-xs text-green-700">
                                    <strong>Obligation :</strong> PV de r√©action au feu obligatoire pour tous les d√©cors
                                </div>
                            </div>
                            
                            <div id="m2-card" onclick="highlightMaterial(2)" class="material-card p-4 rounded-lg border-l-4 border-warning bg-white shadow-sm hover:shadow-md transition cursor-pointer">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-gray-900">Classement M2</h4>
                                    <span class="text-xs bg-orange-100 px-2 py-1 rounded text-orange-700">Difficilement Inflammable</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-2">Autoris√© pour certains si√®ges capitonn√©s ou rev√™tements de sol. N√©cessite souvent ignifugation.</p>
                                <div class="mt-3 text-xs text-gray-500">
                                    <strong>Usage conditionnel :</strong> Mobilier fixe, certains rev√™tements
                                </div>
                            </div>
                            
                            <div id="m4-card" onclick="highlightMaterial(3)" class="material-card p-4 rounded-lg border-l-4 border-accent bg-red-50 shadow-sm hover:shadow-md transition cursor-pointer">
                                <div class="flex justify-between items-center">
                                    <h4 class="font-bold text-gray-900">Classement M3 / M4</h4>
                                    <span class="text-xs bg-red-100 px-2 py-1 rounded text-red-700">Interdit / Risque</span>
                                </div>
                                <p class="text-sm text-gray-600 mt-2">Moyennement √† Facilement inflammable. G√©n√©ralement interdits dans les zones accessibles au public.</p>
                                <div class="mt-3 text-xs text-red-600">
                                    <strong>Attention :</strong> Interdits sauf d√©rogation exceptionnelle avec compensations
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conseils Pratiques -->
                    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-blue-50 p-5 rounded-xl border border-blue-200">
                            <h4 class="font-bold text-blue-800 mb-3">üìã Checklist Mat√©riaux pour le R√©gisseur</h4>
                            <ul class="space-y-2 text-sm text-blue-700">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-blue-600 mr-2 mt-1"></i>
                                    <span>Exiger le PV de r√©action au feu pour tous les d√©cors entrants</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-blue-600 mr-2 mt-1"></i>
                                    <span>V√©rifier la validit√© des traitements ignifuges (3 ans maximum)</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-blue-600 mr-2 mt-1"></i>
                                    <span>Contr√¥ler les rideaux et v√©lums : M1 obligatoire</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-blue-600 mr-2 mt-1"></i>
                                    <span>Archiver les justificatifs dans le registre de s√©curit√©</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="bg-amber-50 p-5 rounded-xl border border-amber-200">
                            <h4 class="font-bold text-amber-800 mb-3">‚ö†Ô∏è Points de Vigilance Fr√©quents</h4>
                            <ul class="space-y-2 text-sm text-amber-700">
                                <li class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-amber-600 mr-2 mt-1"></i>
                                    <span>D√©cors en papier/carton non trait√©s (interdits)</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-amber-600 mr-2 mt-1"></i>
                                    <span>Tentes et chapiteaux sans certification M1</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-amber-600 mr-2 mt-1"></i>
                                    <span>Si√®ges rembourr√©s sans classement M2 minimum</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-exclamation-triangle text-amber-600 mr-2 mt-1"></i>
                                    <span>Rev√™tements de sol inflammables dans les d√©gagements</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Common Violations -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-slate-700 mb-4">Causes Fr√©quentes d'Avis D√©favorable (Commission de S√©curit√©)</h3>
                        <div class="chart-container">
                            <canvas id="violationsChart"></canvas>
                        </div>
                        <p class="text-xs text-gray-500 mt-2 text-center">
                            Donn√©es issues des rapports de commission 2020-2024 pour les ERP Type L et CTS
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ===== EVACUATION VIEW ===== -->
            <div id="view-evacuation" class="hidden space-y-8 tab-transition">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-2">D√©gagements & Unit√©s de Passage - Articles CO</h2>
                    <p class="text-stone-600 mb-6">
                        Le dimensionnement des sorties se fait en <strong>Unit√©s de Passage (UP)</strong>. 
                        1 UP = 0,60 m. Attention, 1 UP seule n√©cessite 0,90 m de large. 2 UP = 1,40 m.
                        Ces r√®gles sont d√©finies par les articles CO 37 √† CO 42 de l'Arr√™t√© du 25 juin 1980.
                    </p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <!-- Controls -->
                        <div class="lg:col-span-1 space-y-6">
                            <div class="bg-gray-50 p-5 rounded-lg">
                                <h4 class="font-bold text-gray-700 mb-4">Simulateur de Dimensionnement</h4>
                                <div class="mb-4">
                                    <label class="block text-sm font-bold text-gray-700 mb-2">Affluence √† √©vacuer : <span id="evacValue" class="text-success text-lg">500</span> pers.</label>
                                    <input type="range" id="evacSlider" min="0" max="2000" step="50" value="500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-success" oninput="updateEvacuation(this.value)">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0 pers.</span>
                                        <span>1000 pers.</span>
                                        <span>2000 pers.</span>
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="bg-white p-3 rounded border border-gray-200 text-center">
                                        <span class="block text-2xl font-bold text-gray-900" id="upResult">6</span>
                                        <span class="text-xs text-gray-500 uppercase">Unit√©s de Passage</span>
                                    </div>
                                    <div class="bg-white p-3 rounded border border-gray-200 text-center">
                                        <span class="block text-2xl font-bold text-gray-900" id="widthResult">3.60m</span>
                                        <span class="text-xs text-gray-500 uppercase">Largeur Cumul√©e</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h5 class="font-bold text-gray-700 text-sm mb-2">Nombre d'issues minimum :</h5>
                                    <p class="text-lg font-bold text-accent" id="exitsResult">2 issues</p>
                                    <p class="text-xs text-gray-500">Selon l'article CO 38</p>
                                </div>
                            </div>
                            
                            <div class="bg-orange-50 p-4 rounded border-l-4 border-warning">
                                <h5 class="font-bold text-orange-800 text-sm mb-2">üö® R√®gle d'Or pour le R√©gisseur :</h5>
                                <p class="text-sm text-orange-900">
                                    Les d√©gagements doivent rester libres de tout obstacle en permanence. 
                                    Les portes doivent s'ouvrir dans le sens de la sortie. 
                                    V√©rifier quotidiennement avant ouverture.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Chart -->
                        <div class="lg:col-span-2">
                            <h4 class="text-sm font-semibold text-gray-500 mb-4 uppercase">Relation entre Effectif et Largeur des D√©gagements</h4>
                            <div class="chart-container">
                                <canvas id="evacChart"></canvas>
                            </div>
                            <div class="mt-4 text-sm text-gray-600">
                                <p><strong>Explication :</strong> La largeur requise augmente par paliers (fonction en escalier). 
                                Chaque palier correspond √† un nombre entier d'Unit√©s de Passage.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Rules Grid -->
                    <div class="mt-8">
                        <h3 class="text-lg font-semibold text-slate-700 mb-4">R√®gles Essentielles d'√âvacuation</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="bg-gray-900 text-white p-5 rounded-lg">
                                <h4 class="font-bold text-lg mb-3 flex items-center">
                                    <i class="fas fa-star text-accent mr-2"></i>
                                    R√®gles d'Or
                                </h4>
                                <ul class="space-y-3 text-sm">
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-accent mr-2 mt-1"></i>
                                        <span>Portes s'ouvrent dans le sens de la sortie (CO 41)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-accent mr-2 mt-1"></i>
                                        <span>D√©gagements libres d'obstacles en permanence</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-accent mr-2 mt-1"></i>
                                        <span>Balisage lumineux obligatoire (BAES - EC 7)</span>
                                    </li>
                                    <li class="flex items-start">
                                        <i class="fas fa-check text-accent mr-2 mt-1"></i>
                                        <span>Signalisations conformes (pictogrammes blanc sur fond vert)</span>
                                    </li>
                                </ul>
                            </div>
                            
                            <div class="bg-gray-50 p-5 rounded-lg">
                                <h4 class="font-bold text-lg mb-3">Largeurs Standards</h4>
                                <div class="grid grid-cols-2 gap-3 text-center">
                                    <div class="p-3 bg-white rounded border border-gray-300">
                                        <span class="block font-bold text-lg">1 UP</span>
                                        <span class="text-sm text-gray-600">0.90 m (minimum)</span>
                                    </div>
                                    <div class="p-3 bg-white rounded border border-gray-300">
                                        <span class="block font-bold text-lg">2 UP</span>
                                        <span class="text-sm text-gray-600">1.40 m</span>
                                    </div>
                                    <div class="p-3 bg-white rounded border border-gray-300">
                                        <span class="block font-bold text-lg">3 UP</span>
                                        <span class="text-sm text-gray-600">1.80 m</span>
                                    </div>
                                    <div class="p-3 bg-white rounded border border-gray-300">
                                        <span class="block font-bold text-lg">N UP</span>
                                        <span class="text-sm text-gray-600">N √ó 0.60 m</span>
                                    </div>
                                </div>
                                <p class="text-xs text-gray-500 mt-3 italic">
                                    Pour N ‚â• 2. 1 UP seule a une largeur sp√©ciale de 0.90m.
                                </p>
                            </div>
                            
                            <div class="bg-gray-50 p-5 rounded-lg">
                                <h4 class="font-bold text-lg mb-3">Seuils Critiques</h4>
                                <ul class="space-y-3 text-sm text-gray-700">
                                    <li class="p-2 bg-white rounded border-l-4 border-green-500">
                                        <strong>&lt; 20 pers</strong> : 1 sortie (0.90m) suffisante
                                    </li>
                                    <li class="p-2 bg-white rounded border-l-4 border-yellow-500">
                                        <strong>20-500 pers</strong> : 2 sorties minimum obligatoires
                                    </li>
                                    <li class="p-2 bg-white rounded border-l-4 border-orange-500">
                                        <strong>501-1000 pers</strong> : 2 sorties minimum
                                    </li>
                                    <li class="p-2 bg-white rounded border-l-4 border-red-500">
                                        <strong>&gt; 1000 pers</strong> : +1 sortie par 500 personnes suppl√©mentaires
                                    </li>
                                </ul>
                                <p class="text-xs text-gray-500 mt-3">
                                    Source : Article CO 38 - R√©partition des sorties
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Conseils Pratiques -->
                    <div class="mt-8 bg-blue-50 p-5 rounded-xl border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-3">üõ†Ô∏è Conseils Pratiques pour le R√©gisseur</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h5 class="font-bold text-blue-700 text-sm mb-2">Avant Ouverture</h5>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ V√©rifier l'ouverture compl√®te de toutes les issues</li>
                                    <li>‚Ä¢ Tester les dispositifs de d√©verrouillage (panic bars)</li>
                                    <li>‚Ä¢ Contr√¥ler l'√©clairage de s√©curit√© (BAES)</li>
                                    <li>‚Ä¢ S'assurer de l'absence d'obstacles dans les circulations</li>
                                </ul>
                            </div>
                            <div>
                                <h5 class="font-bold text-blue-700 text-sm mb-2">Pendant l'Exploitation</h5>
                                <ul class="text-sm text-blue-700 space-y-1">
                                    <li>‚Ä¢ Maintenir les issues accessibles (pas de stockage)</li>
                                    <li>‚Ä¢ Surveiller les files d'attente devant les sorties</li>
                                    <li>‚Ä¢ Former le personnel √† l'√©vacuation</li>
                                    <li>‚Ä¢ Afficher les plans d'√©vacuation √† chaque entr√©e</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ===== CTS VIEW ===== -->
            <div id="view-cts" class="hidden space-y-8 tab-transition">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-2">S√©curit√© Chapiteaux (CTS) & M√©t√©o - Arr√™t√© du 23 janvier 1985</h2>
                    <p class="text-stone-600 mb-6">
                        L'exploitation d'un chapiteau est soumise √† l'Arr√™t√© du 23 janvier 1985 sp√©cifique aux CTS (Chapiteaux, Tentes et Structures). 
                        Deux facteurs critiques : la solidit√© au vent et la r√©action au feu. L'exploitant doit tenir un registre de s√©curit√© et surveiller la m√©t√©o en temps r√©el.
                    </p>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <!-- Wind Calculator -->
                        <div class="bg-gray-50 border border-gray-200 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                                <i class="fas fa-wind mr-2"></i> Simulateur de D√©cision M√©t√©o
                            </h3>
                            <p class="text-sm text-gray-600 mb-4">
                                Selon l'article CTS 16, l'exploitant doit surveiller les conditions m√©t√©orologiques et prendre les mesures appropri√©es.
                            </p>
                            <div class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Vitesse max homologu√©e du chapiteau</label>
                                    <select id="maxWindInput" class="w-full rounded-md border-gray-300 shadow-sm p-2 border bg-white" onchange="updateWindSimulator()">
                                        <option value="85">85 km/h (Structures l√©g√®res ou anciennes)</option>
                                        <option value="100" selected>100 km/h (Standard - conforme √† l'Arr√™t√© 1985)</option>
                                        <option value="120">120 km/h (Renforc√© - structures r√©centes)</option>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">V√©rifier sur le registre de s√©curit√© du chapiteau</p>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Vitesse du vent actuelle (km/h)</label>
                                    <input type="range" id="currentWindInput" min="0" max="140" value="45" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-structure" oninput="updateWindSimulator()">
                                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                                        <span>0 km/h</span>
                                        <span id="currentWindDisplay" class="font-bold text-structure text-base">45 km/h</span>
                                        <span>140 km/h</span>
                                    </div>
                                </div>
                                
                                <!-- Status Indicator -->
                                <div id="weatherStatus" class="bg-green-100 border border-green-200 p-4 rounded-lg flex items-start gap-3">
                                    <div id="weatherIcon" class="text-2xl"><i class="fas fa-check-circle text-green-600"></i></div>
                                    <div>
                                        <h4 id="weatherTitle" class="font-bold text-green-800">Situation Normale</h4>
                                        <p id="weatherDesc" class="text-sm text-green-700">Exploitation autoris√©e. Continuez la veille m√©t√©orologique toutes les 3 heures.</p>
                                    </div>
                                </div>
                                
                                <div class="bg-amber-50 p-3 rounded border border-amber-200">
                                    <h5 class="font-bold text-amber-800 text-sm mb-1">üìã Proc√©dure R√©glementaire</h5>
                                    <p class="text-xs text-amber-700">
                                        <strong>Article CTS 16 :</strong> En cas de vent d√©passant 60 km/h, renforcez la surveillance. 
                                        Au-del√† de 80% de la vitesse max, pr√©parez l'√©vacuation. Au-del√† du max, √©vacuez imm√©diatement.
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Wind Chart -->
                        <div class="bg-white rounded-xl">
                            <h3 class="text-lg font-bold text-gray-900 mb-4">√âchelle de Beaufort & Risques pour CTS</h3>
                            <div class="chart-container">
                                <canvas id="windChart"></canvas>
                            </div>
                            <div class="mt-4 text-sm text-gray-600">
                                <p><strong>Niveau 3 (20-28 km/h) :</strong> Vent mod√©r√© - V√©rification des ancrages recommand√©e</p>
                                <p><strong>Niveau 5 (30-38 km/h) :</strong> Vent frais - Surveillance renforc√©e obligatoire</p>
                                <p><strong>Niveau 7 (50-61 km/h) :</strong> Grand vent - Risque structurel, pr√©paration √©vacuation</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Checklist -->
                    <div class="mt-8">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Points de Contr√¥le Obligatoires pour CTS</h3>
                        <p class="text-sm text-gray-600 mb-4">
                            Checklist bas√©e sur l'Arr√™t√© du 23 janvier 1985 et les bonnes pratiques professionnelles.
                        </p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Ancrages et Haubanage (Art. CTS 10)</span>
                                    <p class="text-xs text-gray-500 mt-1">V√©rifier la tension des sangles et la tenue des pieux. Contr√¥le quotidien obligatoire.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Issues de Secours (Art. CTS 12)</span>
                                    <p class="text-xs text-gray-500 mt-1">D√©verrouill√©es, d√©gag√©es, √©clairage de s√©curit√© fonctionnel. 2 issues minimum oppos√©es.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Extincteurs (Art. CTS 15)</span>
                                    <p class="text-xs text-gray-500 mt-1">En place (1 pour 300m¬≤), plomb√©s, v√©rifi√©s annuellement. Accessibles et signal√©s.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Installations √âlectriques (Art. CTS 18)</span>
                                    <p class="text-xs text-gray-500 mt-1">Coffrets ferm√©s, c√¢bles prot√©g√©s, dispositifs diff√©rentiels 30mA. V√©rification Q18.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Classement au Feu (Art. CTS 8)</span>
                                    <p class="text-xs text-gray-500 mt-1">Toile M1 obligatoire. Certificat de r√©action au feu pr√©sent dans le registre.</p>
                                </div>
                            </div>
                            <div class="flex items-start p-4 bg-gray-50 rounded-lg border border-gray-200">
                                <input type="checkbox" class="mt-1 mr-3 h-5 w-5 text-accent rounded border-gray-300 accent-accent">
                                <div>
                                    <span class="font-medium text-gray-900">Registre de S√©curit√© (Art. CTS 21)</span>
                                    <p class="text-xs text-gray-500 mt-1">Complet et √† jour. Doit contenir les rapports de contr√¥le, PV d'essais, notices.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Documentation Requise -->
                    <div class="mt-8 bg-blue-50 p-5 rounded-xl border border-blue-200">
                        <h4 class="font-bold text-blue-800 mb-3">üìÑ Documents Obligatoires √† Pr√©senter en Commission</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-white p-3 rounded border border-blue-100">
                                <h5 class="font-bold text-blue-700 text-sm mb-1">1. Registre de S√©curit√©</h5>
                                <p class="text-xs text-gray-600">Extrait du registre du chapiteau avec les derniers contr√¥les.</p>
                            </div>
                            <div class="bg-white p-3 rounded border border-blue-100">
                                <h5 class="font-bold text-blue-700 text-sm mb-1">2. Rapport de Montage</h5>
                                <p class="text-xs text-gray-600">Certificat de bon montage sign√© par l'entreprise.</p>
                            </div>
                            <div class="bg-white p-3 rounded border border-blue-100">
                                <h5 class="font-bold text-blue-700 text-sm mb-1">3. Contr√¥les Techniques</h5>
                                <p class="text-xs text-gray-600">Q18 (√©lectricit√©), contr√¥le extincteurs, r√©sistance au vent.</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-700 mt-3">
                            <strong>Conseil :</strong> Pr√©parez ces documents en triple exemplaire pour la commission (1 pour vous, 1 pour les pompiers, 1 pour la mairie).
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- ===== LIBRARY VIEW ===== -->
            <div id="view-library" class="hidden space-y-8 tab-transition">
                <div class="bg-white rounded-xl shadow-sm border border-stone-100 p-6">
                    <h2 class="text-2xl font-semibold text-slate-700 mb-4">Biblioth√®que Officielle L√©gifrance</h2>
                    <p class="text-stone-600 mb-6">
                        Acc√®s direct aux textes consolid√©s de la r√©glementation s√©curit√© incendie. 
                        Utilisez le filtre pour trouver un texte sp√©cifique. Tous les liens pointent vers les versions officielles sur L√©gifrance.
                    </p>
                    
                    <!-- Search -->
                    <div class="mb-6 relative">
                        <input type="text" id="linkSearch" placeholder="Filtrer les textes (ex: S√©curit√©, CTS, √âlectricit√©, D√©gagements...)" 
                               class="w-full pl-10 pr-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-accent focus:border-accent transition-shadow">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                    </div>
                    
                    <!-- Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-2xl font-bold text-gray-900">15</div>
                            <div class="text-xs text-gray-500">Textes r√©f√©renc√©s</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-2xl font-bold text-gray-900">6</div>
                            <div class="text-xs text-gray-500">Th√®mes principaux</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-2xl font-bold text-gray-900">2</div>
                            <div class="text-xs text-gray-500">Arr√™t√©s fondamentaux</div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded text-center">
                            <div class="text-2xl font-bold text-gray-900">1980-2024</div>
                            <div class="text-xs text-gray-500">P√©riode couverte</div>
                        </div>
                    </div>
                    
                    <!-- Links Table -->
                    <div class="overflow-hidden border border-gray-200 rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Th√®me</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Titre & R√©f√©rence</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mots Cl√©s</th>
                                    <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="linksTableBody">
                                <!-- Populated by JS -->
                            </tbody>
                        </table>
                        <div id="noResults" class="hidden p-8 text-center text-gray-500">
                            <i class="fas fa-search mb-2 text-2xl"></i>
                            <p>Aucun texte trouv√© pour cette recherche.</p>
                        </div>
                    </div>
                    
                    <!-- Important Notes -->
                    <div class="mt-6 bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                        <h4 class="font-bold text-yellow-800 mb-2">üìå Notes importantes :</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ Les textes sont accessibles dans leur version consolid√©e (mises √† jour incluses)</li>
                            <li>‚Ä¢ Pour les arr√™t√©s techniques, v√©rifiez toujours les annexes et notes</li>
                            <li>‚Ä¢ Les circulaires d'application compl√®tent les arr√™t√©s mais n'ont pas force r√©glementaire</li>
                            <li>‚Ä¢ En cas de doute, contactez la commission de s√©curit√© comp√©tente</li>
                        </ul>
                    </div>
                </div>
            </div>
            
        </div>
    </main>

    <!-- ===== FOOTER HARMONIS√â ===== -->
    <footer class="bg-[#e9ecef] text-[#495057] py-8 mt-12 border-t border-[#dee2e6]">
        <div class="max-w-8xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">S√©curit√© Incendie</h4>
                    <p class="text-[#6c757d] text-sm mb-2">
                        Application open source d√©di√©e √† la s√©curit√© incendie des ERP Type L et CTS.
                        Conforme aux arr√™t√©s 1980 et 1985.
                    </p>
                    <p class="text-[#6c757d] text-sm">
                        <small>Mise √† jour : 19 d√©cembre 2025</small>
                    </p>
                </div>

                <!-- Deuxi√®me colonne avec bordure gauche -->
                <div class="md:border-l md:border-[] md:pl-8">
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">Applications Connexes</h4>

                    <div class="space-y-4">

                        <a href="https://fi-regie.github.io/Reglementation-Spectacle-Itinerant/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> R√©glementation Spectacle Itin√©rant </h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Portail de veille juridique & de s√©curit√© du Spectacle Itin√©rant
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/Simulateur-Reglement-Securite-ERP/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Outil de Simulation S√©curit√© </h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Simulez votre Cat√©gorie ERP, vos d√©gagements UP, √âch. de Beaufort
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/reglementation-CTS-/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> R√®glementation CTS</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Dispositions applicables aux √©tablissements de type Chapiteaux, Tentes et Structures
                                </p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Troisi√®me colonne avec bordure gauche -->
                <div class="md:border-l md:border-[] md:pl-8">
                    <h4 class="text-xl font-bold mb-4 text-[#343a40]">Formation</h4>
                    <div class="space-y-4">
                        <a href="https://fi-regie.github.io/Formation-Securite-ERP/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Formation S√©curit√© ERP</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Outil p√©dagogique open source destin√© √† la formation des responsables techniques d'ERP Type L
                                </p>
                            </div>
                        </a>

                        <a href="https://fi-regie.github.io/Quiz-CTS/" target="_blank"
                            class="flex items-start text-[#495057] hover:text-[#0d6efd] transition">
                            <i class="fas fa-external-link-alt mr-2 mt-1"></i>
                            <div>
                                <h5> Le Quiz du R√©gisseur</h5>
                                <p class="text-sm text-[#6c757d] mt-1">
                                    Amusez-vous, testez vos connaissances, apprenez...
                                </p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <div class="mt-8 pt-8 border-t border-[#ced4da] text-center text-sm text-[#6c757d]">
                <p>
                    <i class="fas fa-gavel mr-2"></i>
                    Guide de la S√©curit√© Incendie  - Portail de S√©curit√© CTS & ERP Type L
                </p>
                <p class="mt-2">
                    ¬©Ô∏è Open Source ‚Ä¢ Partage Contribution : https://github.com/fi-regie ‚Ä¢ Contact : philippe.potier-regie@proton.me
                </p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // ===== GLOBAL STATE =====
        const app = {
            state: {
                currentView: 'dashboard',
                capacity: 450,
                materialFocus: 1,
                windSpeed: 45,
                maxWind: 100
            },
            
            // ===== NAVIGATION =====
            navigate: (viewId) => {
                // Update State
                app.state.currentView = viewId;
                
                // Hide all views
                document.querySelectorAll('[id^="view-"]').forEach(el => {
                    el.classList.remove('active');
                    el.classList.add('hidden');
                });
                
                // Show target view
                const target = document.getElementById(`view-${viewId}`);
                target.classList.remove('hidden');
                setTimeout(() => {
                    target.classList.add('active');
                }, 10);
                
                // Update Nav Buttons
                document.querySelectorAll('.nav-tab').forEach(btn => {
                    btn.classList.remove('active', 'border-orange-600', 'text-orange-600');
                    btn.classList.add('border-transparent', 'text-gray-600');
                });
                
                const activeBtn = [...document.querySelectorAll('.nav-tab')].find(btn => 
                    btn.getAttribute('onclick')?.includes(`navigate('${viewId}')`)
                );
                
                if(activeBtn) {
                    activeBtn.classList.add('active', 'border-orange-600', 'text-orange-600');
                    activeBtn.classList.remove('border-transparent', 'text-gray-600');
                }
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                // Initialize view-specific components
                if(viewId === 'classification') {
                    calculateCategory();
                } else if(viewId === 'evacuation') {
                    updateEvacuation(500);
                } else if(viewId === 'library') {
                    renderLinksTable(regulationsData);
                }
            },
            
            // ===== INITIALIZATION =====
            init: () => {
                // Initialize all charts
                initCharts();
                
                // Initialize data
                calculateCategory();
                updateEvacuation(500);
                updateWindSimulator();
                renderLinksTable(regulationsData);
                setupSearch();
                
                // Start with dashboard
                app.navigate('dashboard');
                
                // Initialize navigation
                initNavigation();
            }
        };
        
        // ===== INITIALIZE NAVIGATION =====
        function initNavigation() {
            // Add event listeners to all nav buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                if (btn.getAttribute('onclick')?.includes('navigate')) {
                    // Already has onclick, keep it
                }
            });
        }
        
        // ===== DATA =====
        const regulationsData = [
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 25 juin 1980",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP (Dispositions G√©n√©rales). Texte fondamental.",
                keywords: ["feu", "extincteur", "alarme", "erp", "s√©curit√©", "incendie", "g√©n√©ral"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000510784/"
            },
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 23 janvier 1985 (CTS)",
                desc: "R√®glement de s√©curit√© contre les risques d'incendie et de panique dans les ERP de type CTS (Chapiteaux, Tentes et Structures).",
                keywords: ["chapiteau", "tente", "feu", "panique", "√©vacuation", "toile", "vent"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000874028/"
            },
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 22 juin 1990 (PA)",
                desc: "R√®glement de s√©curit√© pour les √©tablissements de type PA (Plein Air). Dispositions sp√©cifiques aux manifestations en ext√©rieur.",
                keywords: ["plein air", "ext√©rieur", "gradins", "enceinte", "manifestation"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000350253/"
            },
            {
                theme: "ERP / S√©curit√©",
                title: "Arr√™t√© du 31 janvier 1986 (Type L)",
                desc: "R√®glement de s√©curit√© pour les √©tablissements de type L (Salles d'auditions, conf√©rences, spectacles).",
                keywords: ["salle", "spectacle", "sc√®ne", "rideau", "si√®ges", "jauge"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000874030/"
            },
            {
                theme: "√âlectricit√©",
                title: "Arr√™t√© du 10 octobre 1972",
                desc: "R√®glement des installations √©lectriques (d√©cret 72-1120). Normes de s√©curit√© pour les installations permanentes et temporaires.",
                keywords: ["√©lectricit√©", "installation", "c√¢ble", "diff√©rentiel", "court-circuit"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000505581/"
            },
            {
                theme: "√âlectricit√©",
                title: "NF C 15-100",
                desc: "Norme fran√ßaise r√©gissant les installations √©lectriques basse tension. R√©f√©rence pour les contr√¥les Q18.",
                keywords: ["norme", "basse tension", "installation", "s√©curit√©", "contr√¥le"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000037020475/"
            },
            {
                theme: "Travail / S√©curit√©",
                title: "Code du travail - Sant√© et s√©curit√©",
                desc: "Dispositions g√©n√©rales sur la sant√© et la s√©curit√© au travail (applicable au montage/d√©montage).",
                keywords: ["s√©curit√©", "travail", "montage", "√©quipement", "casque", "chantier"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072050/"
            },
            {
                theme: "Mat√©riaux",
                title: "Arr√™t√© du 21 novembre 2002",
                desc: "Classification des mat√©riaux de construction et d'am√©nagement selon leur r√©action au feu.",
                keywords: ["mat√©riaux", "classement", "M0", "M1", "ignifuge", "r√©action feu"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000227847/"
            },
            {
                theme: "√âclairage de s√©curit√©",
                title: "Arr√™t√© du 19 novembre 2001",
                desc: "R√®gles techniques relatives √† l'√©clairage de s√©curit√© dans les ERP.",
                keywords: ["√©clairage", "s√©curit√©", "BAES", "√©vacuation", "lumens", "autonomie"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000573847/"
            },
            {
                theme: "D√©senfumage",
                title: "Arr√™t√© du 22 mars 2004",
                desc: "R√®gles techniques relatives au d√©senfumage dans les ERP.",
                keywords: ["d√©senfumage", "fum√©e", "√©vacuation", "ventilation", "extraction"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000416658/"
            },
            {
                theme: "Extincteurs",
                title: "Arr√™t√© du 31 janvier 1986",
                desc: "R√®gles d'installation et d'entretien des extincteurs dans les ERP.",
                keywords: ["extincteur", "portatif", "entretien", "v√©rification", "pression"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000000510829/"
            },
            {
                theme: "Accessibilit√©",
                title: "Arr√™t√© du 8 d√©cembre 2014",
                desc: "Accessibilit√© aux personnes handicap√©es des √©tablissements recevant du public.",
                keywords: ["accessibilit√©", "handicap", "PMR", "rampe", "largeur", "portes"],
                url: "https://www.legifrance.gouv.fr/loda/id/JORFTEXT000029831373/"
            },
            {
                theme: "Bruit / Son",
                title: "Code de la sant√© publique - Bruit",
                desc: "R√©glementation relative √† la pr√©vention des risques li√©s aux bruits et aux sons amplifi√©s.",
                keywords: ["son", "bruit", "voisinage", "d√©cibel", "concert", "nuisance"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000006072665/"
            },
            {
                theme: "Espace Public",
                title: "Code g√©n√©ral de la propri√©t√© des personnes publiques",
                desc: "Articles relatifs √† l'occupation du domaine public (Autorisation d'Occupation Temporaire).",
                keywords: ["rue", "espace public", "mairie", "redevance", "autorisation", "AOT"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000031366252/"
            },
            {
                theme: "S√©curit√© Incendie",
                title: "Code de la s√©curit√© int√©rieure",
                desc: "Dispositions g√©n√©rales relatives √† la s√©curit√© contre les incendies et les paniques.",
                keywords: ["s√©curit√©", "incendie", "r√©glementation", "contr√¥le", "commission"],
                url: "https://www.legifrance.gouv.fr/codes/id/LEGITEXT000025503132/"
            }
        ];
        
        // ===== CHART INSTANCES =====
        let classificationChart, materialsChart, evacChart, windChart, overviewChart, violationsChart;
        
        // ===== FUNCTIONS =====
        
        // Classification Calculator
        function calculateCategory() {
            const capacityInput = document.getElementById('capacityInput');
            if (!capacityInput) return;
            
            const capacity = parseInt(capacityInput.value) || 0;
            app.state.capacity = capacity;
            
            let category, desc, implication, barColors;
            
            if (capacity > 1500) {
                category = "1√®re Cat√©gorie";
                desc = "Plus de 1 500 personnes.";
                implication = "SSIAP permanent 24h/24. Visites commission tous les 3 ans. Dossier de s√©curit√© exhaustif.";
                barColors = ['#d1d5db', '#d1d5db', '#d1d5db', '#ea580c'];
            } else if (capacity > 700) {
                category = "2√®me Cat√©gorie";
                desc = "De 701 √† 1 500 personnes.";
                implication = "SSIAP adapt√© aux horaires. Visites tous les 3 ans. Registre v√©rifi√© annuellement.";
                barColors = ['#d1d5db', '#d1d5db', '#ea580c', '#d1d5db'];
            } else if (capacity > 300) {
                category = "3√®me Cat√©gorie";
                desc = "De 301 √† 700 personnes.";
                implication = "SSIAP selon risque. Visites tous les 3 ans. Formation personnel obligatoire.";
                barColors = ['#d1d5db', '#ea580c', '#d1d5db', '#d1d5db'];
            } else if (capacity >= 200) {
                category = "4√®me Cat√©gorie";
                desc = "Jusqu'√† 300 personnes (‚â•200 pour Type L).";
                implication = "R√®gles all√©g√©es mais registre obligatoire. Visites tous les 5 ans.";
                barColors = ['#ea580c', '#d1d5db', '#d1d5db', '#d1d5db'];
            } else {
                category = "5√®me Cat√©gorie";
                desc = "Moins de 200 personnes (Type L) ou seuil sp√©cifique.";
                implication = "R√®glementation minimale. Issues d√©gag√©es, extincteurs, alarme obligatoires.";
                barColors = ['#3b82f6', '#d1d5db', '#d1d5db', '#d1d5db'];
            }
            
            // Update UI
            const catText = document.getElementById('catText');
            const catDesc = document.getElementById('catDesc');
            const catImplication = document.getElementById('catImplication');
            
            if(catText && catDesc && catImplication) {
                catText.textContent = category;
                catDesc.textContent = desc;
                catImplication.textContent = implication;
                
                // Update exits result if on evacuation page
                const exitsResult = document.getElementById('exitsResult');
                if (exitsResult) {
                    if (capacity > 1000) {
                        exitsResult.textContent = "3 issues minimum";
                    } else if (capacity > 20) {
                        exitsResult.textContent = "2 issues minimum";
                    } else {
                        exitsResult.textContent = "1 issue suffisante";
                    }
                }
                
                // Update Chart Colors
                if(classificationChart) {
                    classificationChart.data.datasets[0].backgroundColor = barColors;
                    classificationChart.update();
                }
            }
        }
        
        // Materials Highlight
        function highlightMaterial(index) {
            const materialCards = document.querySelectorAll('.material-card');
            if (!materialCards.length) return;
            
            materialCards.forEach(el => {
                el.classList.remove('ring-2', 'ring-green-500', 'bg-green-50', 'bg-gray-50', 'ring-gray-400', 'ring-red-400');
                el.classList.add('bg-white');
            });
            
            const ids = ['m0-card', 'm1-card', 'm2-card', 'm4-card'];
            const selected = document.getElementById(ids[index]);
            if(selected) {
                selected.classList.remove('bg-white');
                const ringColors = ['ring-gray-400', 'ring-green-500', 'ring-yellow-400', 'ring-red-400'];
                selected.classList.add('bg-gray-50', 'ring-2', ringColors[index]);
            }
            
            // Update Chart Highlight
            const colors = ['#9CA3AF', '#059669', '#D97706', '#ea580c'];
            const bgColors = colors.map((c, i) => i === index ? c : c + '40');
            
            if(materialsChart) {
                materialsChart.data.datasets[0].backgroundColor = bgColors;
                materialsChart.update();
            }
        }
        
        // Evacuation Calculator
        function updateEvacuation(val) {
            const evacValue = document.getElementById('evacValue');
            const upResult = document.getElementById('upResult');
            const widthResult = document.getElementById('widthResult');
            const exitsResult = document.getElementById('exitsResult');
            
            if(!evacValue || !upResult || !widthResult) return;
            
            evacValue.textContent = val;
            
            let ups = Math.ceil(val / 100);
            if(ups < 2 && val > 19) ups = 2;
            if(val === 0) ups = 0;
            
            let width;
            if (ups === 1) {
                width = 0.90;
            } else if (ups === 2) {
                width = 1.40;
            } else {
                width = (ups * 0.60).toFixed(2);
            }
            
            upResult.textContent = ups;
            widthResult.textContent = width + "m";
            
            if (exitsResult) {
                if (val > 1000) {
                    exitsResult.textContent = "3 issues minimum";
                } else if (val > 20) {
                    exitsResult.textContent = "2 issues minimum";
                } else if (val > 0) {
                    exitsResult.textContent = "1 issue suffisante";
                } else {
                    exitsResult.textContent = "0 issue";
                }
            }
        }
        
        // Wind Simulator
        function updateWindSimulator() {
            const slider = document.getElementById('currentWindInput');
            const display = document.getElementById('currentWindDisplay');
            const maxSelect = document.getElementById('maxWindInput');
            
            if(!slider || !display || !maxSelect) return;
            
            const current = parseInt(slider.value);
            const max = parseInt(maxSelect.value);
            
            display.innerText = current + " km/h";
            
            const statusBox = document.getElementById('weatherStatus');
            const icon = document.getElementById('weatherIcon');
            const title = document.getElementById('weatherTitle');
            const desc = document.getElementById('weatherDesc');
            
            const warningThreshold = max * 0.75;
            const dangerThreshold = max * 0.90;
            
            statusBox.className = "p-4 rounded-lg flex items-start gap-3 transition-colors duration-300 border";
            
            if (current >= max) {
                statusBox.classList.add('bg-red-100', 'border-red-200');
                icon.innerHTML = '<i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>';
                title.innerText = "√âVACUATION IMM√âDIATE";
                title.className = "font-bold text-red-800";
                desc.innerText = `Vent sup√©rieur √† la limite d'homologation (${max} km/h). Affalement de la structure ou √©vacuation du public requis imm√©diatement.`;
                desc.className = "text-sm text-red-700";
            } else if (current >= dangerThreshold) {
                statusBox.classList.add('bg-red-100', 'border-red-200');
                icon.innerHTML = '<i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>';
                title.innerText = "DANGER IMMINENT";
                title.className = "font-bold text-red-800";
                desc.innerText = `Vent √† >90% de la limite (${max} km/h). Arr√™t imm√©diat de l'activit√©. Pr√©paration √©vacuation.`;
                desc.className = "text-sm text-red-700";
            } else if (current >= warningThreshold) {
                statusBox.classList.add('bg-orange-100', 'border-orange-200');
                icon.innerHTML = '<i class="fas fa-exclamation-triangle text-orange-600 text-2xl"></i>';
                title.innerText = "Vigilance Renforc√©e";
                title.className = "font-bold text-orange-800";
                desc.innerText = `Vent √† >75% de la limite. Pr√©parez l'√©vacuation. V√©rifiez les ancrages toutes les 30 minutes.`;
                desc.className = "text-sm text-orange-700";
            } else if (current >= 60) {
                statusBox.classList.add('bg-yellow-100', 'border-yellow-200');
                icon.innerHTML = '<i class="fas fa-exclamation-circle text-yellow-600 text-2xl"></i>';
                title.innerText = "Surveillance Active";
                title.className = "font-bold text-yellow-800";
                desc.innerText = "Vent mod√©r√© √† fort. Surveillance horaire obligatoire. V√©rifiez les haubans.";
                desc.className = "text-sm text-yellow-700";
            } else {
                statusBox.classList.add('bg-green-100', 'border-green-200');
                icon.innerHTML = '<i class="fas fa-check-circle text-green-600 text-2xl"></i>';
                title.innerText = "Situation Normale";
                title.className = "font-bold text-green-800";
                desc.innerText = "Vitesse de vent admissible. Exploitation autoris√©e sous surveillance m√©t√©o toutes les 3 heures.";
                desc.className = "text-sm text-green-700";
            }
        }
        
        // Library Search
        function renderLinksTable(data) {
            const tbody = document.getElementById('linksTableBody');
            const noResults = document.getElementById('noResults');
            
            if(!tbody) return;
            
            tbody.innerHTML = '';
            
            if(data.length === 0) {
                if(noResults) noResults.classList.remove('hidden');
                return;
            } else {
                if(noResults) noResults.classList.add('hidden');
            }
            
            data.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-gray-50 transition-colors";
                tr.innerHTML = `
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                            ${item.theme}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-bold text-gray-900">${item.title}</div>
                        <div class="text-sm text-gray-500">${item.desc}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex flex-wrap gap-1">
                            ${item.keywords.map(k => `<span class="text-xs text-gray-400 border border-gray-200 rounded px-1">${k}</span>`).join('')}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                        <a href="${item.url}" target="_blank" class="text-accent hover:text-red-800 font-bold hover:underline flex items-center justify-end">
                            Consulter <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                        </a>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function setupSearch() {
            const input = document.getElementById('linkSearch');
            if(!input) return;
            
            input.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = regulationsData.filter(item => 
                    item.title.toLowerCase().includes(term) || 
                    item.desc.toLowerCase().includes(term) || 
                    item.keywords.some(k => k.toLowerCase().includes(term)) ||
                    item.theme.toLowerCase().includes(term)
                );
                renderLinksTable(filtered);
            });
        }
        
        // ===== CHARTS INITIALIZATION =====
        function initCharts() {
            Chart.defaults.font.family = "'Inter', sans-serif";
            
            // 1. Overview Chart (Dashboard)
            const ctxOverview = document.getElementById('overviewChart');
            if(ctxOverview) {
                overviewChart = new Chart(ctxOverview.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['S√©curit√© Incendie', 'Solidit√© / Vent', 'Administratif', 'Droit du Travail', 'Autres'],
                        datasets: [{
                            data: [35, 25, 20, 15, 5],
                            backgroundColor: ['#ea580c', '#D97706', '#374151', '#9CA3AF', '#FCD34D'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'right',
                                labels: {
                                    font: {
                                        size: 11
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // 2. Classification Chart
            const ctxClass = document.getElementById('classificationChart');
            if(ctxClass) {
                classificationChart = new Chart(ctxClass.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Cat 5 (<200)', 'Cat 4 (200-300)', 'Cat 3 (301-700)', 'Cat 2 (701-1500)', 'Cat 1 (>1500)'],
                        datasets: [{
                            label: 'Seuil de Personnes',
                            data: [200, 300, 700, 1500, 2000],
                            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ea580c', '#dc2626'],
                            borderRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `Seuil : ${context.parsed.y} personnes`;
                                    }
                                }
                            }
                        },
                        scales: {
                            y: { 
                                display: true, 
                                title: { 
                                    display: true, 
                                    text: 'Jauge Maximale (Personnes)' 
                                },
                                grid: {
                                    display: true
                                }
                            },
                            x: { 
                                grid: { display: false }
                            }
                        }
                    }
                });
            }
            
            // 3. Materials Chart
            const ctxMat = document.getElementById('materialsChart');
            if(ctxMat) {
                materialsChart = new Chart(ctxMat.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: ['M0 (Structure)', 'M1 (D√©cors)', 'M2 (Mobilier)', 'M3/M4 (Interdit)'],
                        datasets: [{
                            data: [20, 50, 20, 10],
                            backgroundColor: ['#9CA3AF', '#059669', '#D97706', '#ea580c'],
                            borderWidth: 0,
                            hoverOffset: 10
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                position: 'bottom', 
                                labels: { 
                                    usePointStyle: true, 
                                    font: { size: 10 },
                                    padding: 15
                                } 
                            },
                            title: { 
                                display: true, 
                                text: 'R√©partition de S√©curit√© Id√©ale en ERP Type L',
                                font: {
                                    size: 14
                                }
                            }
                        },
                        cutout: '60%'
                    }
                });
            }
            
            // 4. Violations Chart
            const ctxViol = document.getElementById('violationsChart');
            if(ctxViol) {
                violationsChart = new Chart(ctxViol.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Issues Bloqu√©es', 'Mat√©riaux non-M1', 'Extincteurs p√©rim√©s', 'Install. √âlectrique', 'Absence Registre'],
                        datasets: [{
                            label: 'Fr√©quence des anomalies (%)',
                            data: [35, 25, 15, 12, 13],
                            backgroundColor: '#ea580c',
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                beginAtZero: true, 
                                max: 40,
                                grid: { display: false },
                                title: {
                                    display: true,
                                    text: 'Pourcentage des visites'
                                }
                            },
                            x: { 
                                grid: { display: false }
                            }
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.parsed.y}% des avis d√©favorables`;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            // 5. Evacuation Chart
            const ctxEvac = document.getElementById('evacChart');
            if(ctxEvac) {
                const population = [0, 20, 50, 100, 200, 300, 500, 700, 1000, 1500, 2000];
                const widths = population.map(p => {
                    let ups = Math.ceil(p / 100);
                    if (ups < 2 && p > 19) ups = 2;
                    if (p === 0) return 0;
                    if (ups === 1) return 0.90;
                    if (ups === 2) return 1.40;
                    return (ups * 0.60);
                });
                
                evacChart = new Chart(ctxEvac.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: population,
                        datasets: [{
                            label: 'Largeur requise (m)',
                            data: widths,
                            borderColor: '#059669',
                            backgroundColor: '#05966920',
                            fill: true,
                            tension: 0,
                            pointRadius: 3,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#059669',
                            pointBorderWidth: 2,
                            stepped: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const p = context.label;
                                        let ups = Math.ceil(p / 100);
                                        if (ups < 2 && p > 19) ups = 2;
                                        if (p === 0) return '0 UP (0m)';
                                        if (ups === 1) return '1 UP (0.90m)';
                                        if (ups === 2) return '2 UP (1.40m)';
                                        return `${ups} UP (${context.parsed.y.toFixed(2)} m)`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { 
                                title: { 
                                    display: true, 
                                    text: 'Public √† √âvacuer (Personnes)' 
                                },
                                grid: {
                                    display: true
                                }
                            },
                            y: { 
                                title: { 
                                    display: true, 
                                    text: 'Largeur Cumul√©e des Sorties (m)' 
                                },
                                grid: {
                                    display: true
                                }
                            }
                        }
                    }
                });
            }
            
            // 6. Wind Chart
            const ctxWind = document.getElementById('windChart');
            if(ctxWind) {
                windChart = new Chart(ctxWind.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Calme (0-50)', 'Mod√©r√© (50-85)', 'Fort (85-100)', 'Temp√™te (100+)'],
                        datasets: [{
                            label: 'Niveau de Risque',
                            data: [10, 60, 90, 100],
                            backgroundColor: ['#10B981', '#FBBF24', '#D97706', '#ea580c'],
                            borderRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: { 
                                display: false, 
                                max: 100 
                            },
                            x: { 
                                grid: { display: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: (ctx) => {
                                        const descs = [
                                            "Exploitation normale - Surveillance standard",
                                            "Vigilance renforc√©e - Contr√¥le ancrages",
                                            "Danger - Pr√©paration √©vacuation",
                                            "√âvacuation imm√©diate - Risque structurel"
                                        ];
                                        return descs[ctx.dataIndex];
                                    }
                                }
                            }
                        }
                    }
                });
            }
        }
        
        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', app.init);
        
        // S'assurer que la page commence toujours en haut
        window.addEventListener('load', function() {
            window.scrollTo(0, 0);
        });
    </script>
</body>
</html>
